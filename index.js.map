{"version":3,"file":"index.js","sources":["source/context.js","source/ErrorCatcherProvider.js","source/withErrorCatcher.js"],"sourcesContent":["import { createContext } from 'react';\r\n\r\nexport const { Provider, Consumer } = createContext({\r\n  tryCall: (handler, ...args) => handler(...args),\r\n  tryWrap: (handler) => (...args) => handler(...args),\r\n});\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { Provider } from './context';\r\n\r\nclass ErrorCatcherProvider extends Component {\r\n  static propTypes = {\r\n    whenDidCatch: PropTypes.func.isRequired,\r\n    children: PropTypes.node.isRequired,\r\n  };\r\n\r\n  constructor(...init) {\r\n    super(...init);\r\n\r\n    const tryCall = (handler, args) => {\r\n      try {\r\n        return handler(...args);\r\n      } catch (error) {\r\n        this.componentDidCatch(error);\r\n      }\r\n\r\n      // TODO This will give some unexpected side effects, but on other side\r\n      // not recoverable error was thrown. Should I throw new error here instead\r\n      // of giving undefined? Needs testing.\r\n      return undefined;\r\n    };\r\n\r\n    this.providerValue = {\r\n      tryCall: (handler, ...args) => tryCall(handler, args),\r\n      tryWrap: (handler) => (...args) => tryCall(handler, args),\r\n    };\r\n  }\r\n\r\n  componentDidCatch(error, info) {\r\n    this.props.whenDidCatch(error, info);\r\n  }\r\n\r\n  render() {\r\n    return <Provider value={this.providerValue}>{this.props.children}</Provider>;\r\n  }\r\n}\r\n\r\nexport default ErrorCatcherProvider;\r\n","import React, { Component } from 'react';\r\nimport isFunction from '@actualwave/is-function';\r\n\r\nimport { Consumer } from './context';\r\n\r\nconst NO_WRAPS = {};\r\n\r\nconst withErrorCatcher = (WrappedComponent, wrapFnProps = true, displayName = '') => {\r\n  class ErrorCatcherWrapper extends Component {\r\n    wrapsMap = null;\r\n\r\n    wraps = null;\r\n\r\n    wrapsUpToDate = false;\r\n\r\n    componentWillReceiveProps() {\r\n      this.wrapsUpToDate = false;\r\n    }\r\n\r\n    createWraps(tryWrap) {\r\n      const { props } = this;\r\n      const wraps = {};\r\n      const wrapsMap = new Map();\r\n\r\n      /*\r\n      Object.keys(props).forEach((key) => {\r\n        const value = props[key];\r\n\r\n        if (isFunction(value)) {\r\n          const wrap = tryWrap(value);\r\n\r\n          wraps[key] = wrap;\r\n          wrapsMap.set(value);\r\n        }\r\n      });\r\n      */\r\n\r\n      for (const key in props) {\r\n        if (props.hasOwnProperty(key)) {\r\n          const value = props[key];\r\n\r\n          if (isFunction(value)) {\r\n            const wrap = tryWrap(value);\r\n\r\n            wraps[key] = wrap;\r\n            wrapsMap.set(value);\r\n          }\r\n        }\r\n      }\r\n\r\n      this.wraps = wraps;\r\n      this.wrapsMap = wrapsMap;\r\n    }\r\n\r\n    areCallbacksChanged() {\r\n      const { wrapsMap, props } = this;\r\n      let count = 0;\r\n\r\n      for (const key in props) {\r\n        if (props.hasOwnProperty(key)) {\r\n          const value = props[key];\r\n\r\n          if (isFunction(value)) {\r\n            if (wrapsMap.has(value)) {\r\n              count++;\r\n            } else {\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      return wrapsMap.size !== count;\r\n    }\r\n\r\n    childrenRenderer = (catcher) => {\r\n      if (wrapFnProps && !this.wrapsUpToDate) {\r\n        const { tryWrap } = catcher;\r\n\r\n        if (!this.wrapsMap || this.areCallbacksChanged()) {\r\n          this.createWraps(tryWrap);\r\n        }\r\n      }\r\n\r\n      const wraps = this.wraps || NO_WRAPS;\r\n\r\n      return <WrappedComponent {...this.props} {...wraps} {...catcher} />;\r\n    };\r\n\r\n    render() {\r\n      return <Consumer>{this.childrenRenderer}</Consumer>;\r\n    }\r\n  }\r\n\r\n  if (displayName) {\r\n    ErrorCatcherWrapper.displayName = displayName;\r\n  } else {\r\n    const name = Component.displayName || Component.name || 'Component';\r\n\r\n    ErrorCatcherWrapper.displayName = `withErrorCatcher(${name})`;\r\n  }\r\n\r\n  return ErrorCatcherWrapper;\r\n};\r\n\r\nexport default withErrorCatcher;\r\n"],"names":["Provider","Consumer","createContext","tryCall","handler","args","tryWrap","ErrorCatcherProvider","Component","constructor","init","error","componentDidCatch","undefined","providerValue","info","props","whenDidCatch","render","React","children","PropTypes","func","isRequired","node","NO_WRAPS","withErrorCatcher","WrappedComponent","wrapFnProps","displayName","ErrorCatcherWrapper","catcher","wrapsUpToDate","wrapsMap","areCallbacksChanged","createWraps","wraps","componentWillReceiveProps","Map","key","hasOwnProperty","value","isFunction","wrap","set","count","has","size","childrenRenderer","name"],"mappings":"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"}